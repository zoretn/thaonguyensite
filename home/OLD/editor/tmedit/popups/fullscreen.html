<!--
// Based on tmEdit v3.0 - Copyright (c) 2002-2004 interactivetools.com, inc., dynarch.com
// TMEdit - © Copyright 2004, 2005 thinkmambo.com
// Released under ThinMambo Free Software License (see TMEdit_license.txt)
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
  <head>
	<title>Popup Editor</title>
	<script type="text/javascript">	
	_editor_url = window.opener._editor_url;	
	_editor_lang = window.opener._editor_lang;
	var BASE = window.opener.document.baseURI || window.opener.document.URL;	
	var head = document.getElementsByTagName("head")[0];	
	var base = document.createElement("base");
	base.href = BASE;	
	head.appendChild(base);	
	document.write("<scr" + "ipt type='text/javascript' src='" + _editor_url + "tmedit.js'></scr" + "ipt>");
	</script>
	<script type="text/javascript">
	var scripts = window.opener.TMEdit._scripts;
	for (var i = 4; i < scripts.length; ++i) {
		document.write("<scr" + "ipt type='text/javascript' src='" + scripts[i] + "'></scr" + "ipt>");
	}
	</script>
	<script type="text/javascript">
	var parent_object  = null;
	var editor	   = null;	
	
	function _CloseOnEsc(ev) {
		ev || (ev = window.event);
		if (ev.keyCode == 27) {
			
			window.close();
			return;
		}
	}
	
	function resize_editor() {  
		var newHeight;
		if (document.all) {
			newHeight = document.body.offsetHeight - editor._toolbar.offsetHeight;
			if (newHeight < 0) { newHeight = 0; }
		} else {
			
			newHeight = window.innerHeight - editor._toolbar.offsetHeight;
		}
		if (editor.config.statusBar) {
			newHeight -= editor._statusBar.offsetHeight;
		}
		editor._textArea.style.height = editor._iframe.style.height = (newHeight-10) + "px"; 
	}
	
	function init() {
		parent_object = opener.TMEdit._object;
		var config = TMEdit.cloneObject( parent_object.config );
		config.width = "100%";
		config.height = "auto";
		config.btnList["popupeditor"] = [ 'Minimize Editor', _editor_url + 'images/fullscreen_minimize.gif', true,
		function() { window.close(); } ];
		editor = new TMEdit("editor", config);
		for (var i in parent_object.plugins) {
			var plugin = parent_object.plugins[i];
			editor.registerPlugin2(plugin.name, plugin.args);
		}
		config.toolbar = parent_object.config.toolbar;
		editor.generate();
		editor._iframe.style.width = "100%";
		editor._textArea.style.width = "100%";
		editor._toolbar.style.height = "auto";
		resize_editor();
		editor.doctype = parent_object.doctype;
		setTimeout(function() {
		editor.setHTML(parent_object.getInnerHTML());
		if (parent_object._mode == "textmode") { editor.setMode("textmode"); }
		setInterval(update_parent, 500);
		window.onresize = resize_editor;
		}, 333);
	}
	
	function update_parent() {
		parent_object.setHTML(editor.getInnerHTML());
	}
</script>
<style type="text/css"> html, body { height: 100%; margin: 0px; border: 0px; background-color: buttonface; } </style>
</head>
  <body scroll="no" onload="setTimeout(function(){init();}, 500)" onunload="update_parent()">
	<form style="margin: 0px; border: 1px solid; border-color: threedshadow threedhighlight threedhighlight threedshadow;">
	  <textarea name="editor" id="editor" style="width:100%; height:300px">&nbsp;</textarea>
	</form>
  </body>
</html>